<?php

function uib_sebra__uib_ou_nid($place_id) {
    $query = new EntityFieldQuery;
    $result = $query
      ->entityCondition('entity_type', 'node')
      ->entityCondition('bundle', 'uib_ou')
      ->fieldCondition('field_uib_ou_id', 'value', $place_id, '=')
      ->range(0,1)
      ->execute();

    if (!empty($result['node'])) {
      $nids = array_keys($result['node']);
      return $nids[0];
    }
    return NULL;
}

function uib_sebra__create_uib_ou($place_id) {
  $place = new SebraPlace($place_id);
  $node = new stdClass();
  $node->type = 'uib_ou';
  $node->title = $place->name;
  $node->uid = 1;
  $node->status = 1;
  $node->revision = 0;
  $node->language = 'und';
  $node->field_uib_ou_id['und'][0]['value'] = $place_id;
  $node->field_uib_ou_shortname['und'][0]['value'] = $place->alias;
  $node->field_uib_mail_domain['und'][0]['value'] = $place->maildomain;

  $node->field_uib_postal_address['und'][0]['thoroughfare'] = 'Postboks ' . $place->postbox;
  $node->field_uib_postal_address['und'][0]['postal_code'] = $place->postcode;
  $node->field_uib_postal_address['und'][0]['locality'] = $place->postarea;
  $node->field_uib_postal_address['und'][0]['country'] = 'NO';

  $node->field_uib_visit_address['und'][0]['thoroughfare'] = $place->address;
  $node->field_uib_visit_address['und'][0]['postal_code'] = $place->postcode;
  $node->field_uib_visit_address['und'][0]['locality'] = $place->postarea;
  $node->field_uib_visit_address['und'][0]['country'] = 'NO';

  if (isset($place->phone))
    $node->field_uib_phone['und'][0]['value'] = '+47 ' . $place->phone;
  if (isset($place->fax))
    $node->field_uib_fax['und'][0]['value'] = '+47 ' . $place->fax;

  node_save($node);
  return $node;
}
