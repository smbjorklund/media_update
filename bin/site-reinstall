#!/bin/sh

# syntax site-reinstall [--discard] [postgres] [databasename]
# if --discard is given as first arg, skips backup of database+site

test -L site || exit 1
SITE=$(basename $(readlink site))

if [ "$1" = "--discard" ]; then
    bin/site-uninstall --discard
else
    bin/site-uninstall
fi

if [ -e sitecmdline ];then
   read -r CMDLINE < sitecmdline
	if bin/site-install $CMDLINE; then
		bin/site-drush migrate-import --verbose --all
		bin/site-drush uib-migrate-build-menu --verbose
		bin/site-drush pm-enable --yes uib_devel
   fi
else
   if bin/site-install $SITE $1 $2; then
      bin/site-drush migrate-import --verbose --all
      bin/site-drush uib-migrate-build-menu --verbose
      bin/site-drush pm-enable --yes uib_devel
   fi
fi

